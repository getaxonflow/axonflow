# CLA Assistant Workflow
# Automatically checks that contributors have signed the CLA before merging
#
# Setup: Install the CLA Assistant GitHub App from https://github.com/apps/cla-assistant
# and configure it to use this repository's CLA document.

name: CLA Assistant

on:
  issue_comment:
    types: [created]
  pull_request_target:
    types: [opened, synchronize, reopened]

# Prevent concurrent CLA checks on the same PR
concurrency:
  group: cla-${{ github.event.pull_request.number || github.event.issue.number }}
  cancel-in-progress: false

permissions:
  actions: write
  contents: write  # Need write to create cla-signatures branch
  pull-requests: write
  statuses: write

jobs:
  check-cla:
    name: Check CLA Signature
    runs-on: ubuntu-latest
    if: |
      (github.event.comment.body == 'recheck' || github.event.comment.body == 'I have read the CLA Document and I hereby sign the CLA') ||
      github.event_name == 'pull_request_target'
    steps:
      - name: CLA Assistant
        uses: contributor-assistant/github-action@v2.6.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PERSONAL_ACCESS_TOKEN: ${{ secrets.CLA_ASSISTANT_PAT }}
        with:
          # Path to CLA document in this repository
          path-to-document: 'https://github.com/getaxonflow/axonflow/blob/main/.github/CLA.md'

          # Branch where signatures are stored
          branch: 'cla-signatures'

          # Allowlist for bot accounts (no CLA needed)
          allowlist: 'bot*,dependabot[bot],github-actions[bot],renovate[bot]'

          # Custom messages
          custom-notsigned-prcomment: |
            ## CLA Signature Required

            Thank you for your contribution! Before we can merge this PR, we need you to sign our [Contributor License Agreement (CLA)](.github/CLA.md).

            ### How to Sign

            Please read the [CLA document](.github/CLA.md) and comment below with:

            ```
            I have read the CLA Document and I hereby sign the CLA
            ```

            ### Why is this needed?

            The CLA protects both you and AxonFlow:
            - **For you**: Confirms you have the right to submit the code
            - **For the project**: Ensures we can legally distribute your contributions

            This is a one-time process - once signed, all your future contributions are covered.

            ---
            *Questions? Contact [oss@getaxonflow.com](mailto:oss@getaxonflow.com)*

          custom-pr-sign-comment: 'I have read the CLA Document and I hereby sign the CLA'

          # Lock PRs that fail CLA check
          lock-pullrequest-aftermerge: false

          # Use pull request number for tracking
          use-dco-flag: false
